<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>francais-citations</title>

<style>
    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        -webkit-tap-highlight-color: transparent;
    }

    body {
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        background: linear-gradient(135deg, #2C75FF, #002FA7);
        min-height: 100vh;
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 20px;
        overflow-x: hidden;
    }

    .container {
        max-width: 900px;
        width: 100%;
        position: relative;
        z-index: 1;
    }

    .header {
        text-align: center;
        color: white;
        margin-bottom: 25px;
    }

    .header h1 {
        font-size: 2.2em;
        margin-bottom: 8px;
        text-shadow: 0 2px 5px rgba(0,0,0,0.2);
    }

    .header p {
        opacity: 0.95;
    }

    .top-panels {
        display: grid;
        grid-template-columns: 1fr;
        gap: 12px;
        margin-bottom: 18px;
    }

    .panel {
        background: rgba(255,255,255,0.16);
        border: 1px solid rgba(255,255,255,0.18);
        border-radius: 18px;
        padding: 12px 14px;
        color: white;
        backdrop-filter: blur(6px);
        box-shadow: 0 8px 18px rgba(0,0,0,0.15);
    }

    .panel-row {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
        justify-content: center;
        align-items: center;
    }

    .btn {
        padding: 10px 18px;
        border-radius: 50px;
        font-weight: 700;
        cursor: pointer;
        border: none;
        background: white;
        color: #2C75FF;
        box-shadow: 0 4px 6px rgba(0,0,0,0.12);
        transition: transform 0.2s, opacity 0.2s;
        user-select: none;
    }

    .btn:active {
        transform: scale(0.95);
    }

    .btn.secondary {
        background: rgba(255,255,255,0.92);
        color: #0b2a88;
    }

    .btn.danger {
        background: rgba(255,255,255,0.92);
        color: #b91c1c;
    }

    .btn-know {
        background: linear-gradient(135deg, #10b981, #059669);
        color: white;
    }

    .btn-dontknow {
        background: linear-gradient(135deg, #f59e0b, #d97706);
        color: white;
    }

    .select {
        border: none;
        border-radius: 50px;
        padding: 10px 14px;
        font-weight: 700;
        outline: none;
        cursor: pointer;
        background: white;
        color: #2C75FF;
        box-shadow: 0 4px 6px rgba(0,0,0,0.12);
    }

    .stats {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
        justify-content: center;
        font-weight: 700;
    }

    .chip {
        background: rgba(255,255,255,0.22);
        border: 1px solid rgba(255,255,255,0.2);
        padding: 6px 12px;
        border-radius: 999px;
        color: white;
        font-size: 14px;
    }

    /* --- CARTE --- */
    .card-scene {
        perspective: 1000px;
        width: 100%;
        height: 450px;
        cursor: pointer;
    }

    .card {
        width: 100%;
        height: 100%;
        position: relative;
        transition: transform 0.6s cubic-bezier(0.4, 0.2, 0.2, 1);
        transform-style: preserve-3d;
        border-radius: 25px;
        box-shadow: 0 15px 35px rgba(0,0,0,0.2);
    }

    .card.is-flipped {
        transform: rotateY(180deg);
    }

    .card-face {
        position: absolute;
        width: 100%;
        height: 100%;
        backface-visibility: hidden;
        -webkit-backface-visibility: hidden;
        border-radius: 25px;
        padding: 40px;
        background: white;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        text-align: center;
    }

    .card-face.back {
        transform: rotateY(180deg);
        background: #fdfdfd;
    }

    .card-label {
        position: absolute;
        top: 30px;
        font-size: 13px;
        font-weight: 900;
        padding: 8px 20px;
        border-radius: 20px;
        color: white;
        text-transform: uppercase;
        letter-spacing: 1px;
    }

    .bg-question {
        background: linear-gradient(135deg, #74D0F1, #0000FF);
    }

    .bg-answer {
        background: linear-gradient(135deg, #10b981, #059669);
    }

    .card-content {
        font-size: 22px;
        line-height: 1.6;
        color: #333;
        width: 100%;
        overflow-y: auto;
        max-height: 80%;
        white-space: pre-line;
    }

    mjx-container {
        font-size: 110% !important;
        outline: none;
    }

    .card-hint {
        position: absolute;
        bottom: 18px;
        font-size: 14px;
        color: #aaa;
        width: 100%;
        text-align: center;
    }

    /* --- BADGE ETAT CARTE --- */
    .status-pill {
        position: absolute;
        top: 30px;
        right: 30px;
        font-size: 12px;
        font-weight: 900;
        padding: 8px 12px;
        border-radius: 999px;
        color: white;
        text-transform: uppercase;
        letter-spacing: 0.7px;
        box-shadow: 0 8px 18px rgba(0,0,0,0.15);
    }

    .status-unknown {
        background: linear-gradient(135deg, #f59e0b, #d97706);
    }

    .status-known {
        background: linear-gradient(135deg, #10b981, #059669);
    }

    .status-unset {
        background: linear-gradient(135deg, #64748b, #475569);
    }

    /* --- NAVIGATION --- */
    .navigation {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-top: 22px;
        padding: 0 10px;
    }

    .nav-btn {
        width: 50px;
        height: 50px;
        border-radius: 50%;
        border: none;
        background: linear-gradient(135deg, #74D0F1, #0000FF);
        color: white;
        font-size: 20px;
        cursor: pointer;
        transition: transform 0.2s;
        display: flex;
        align-items: center;
        justify-content: center;
        box-shadow: 0 4px 10px rgba(0,0,0,0.2);
    }

    .nav-btn:hover {
        transform: scale(1.1);
    }

    .nav-btn:active {
        transform: scale(0.9);
    }

    .counter {
        color: white;
        font-size: 18px;
        font-weight: 700;
        background: rgba(255,255,255,0.2);
        padding: 5px 15px;
        border-radius: 15px;
    }

    .progress-bar {
        margin-top: 20px;
        height: 8px;
        background: rgba(0,0,0,0.2);
        border-radius: 10px;
        overflow: hidden;
    }

    .progress-fill {
        height: 100%;
        background: linear-gradient(90deg, #74D0F1, #0000FF);
        width: 0%;
        transition: width 0.3s ease-out;
    }

    .keyboard-hint {
        text-align: center;
        color: rgba(255,255,255,0.6);
        font-size: 12px;
        margin-top: 10px;
    }

    /* --- BOUTONS JE SAIS / JE SAIS PAS --- */
    .knowbar {
        display: flex;
        gap: 12px;
        justify-content: center;
        margin-top: 18px;
        flex-wrap: wrap;
    }

    @media (max-width: 520px) {
        .card-face { padding: 28px; }
        .card-content { font-size: 19px; }
        .status-pill { top: 20px; right: 20px; }
    }
</style>


</head><script>
  window.MathJax = {
    tex: {
        inlineMath: [['$', '$'], ['\\(', '\\)']],
        displayMath: [['$$', '$$'], ['\\[', '\\]']]
    },
    svg: { fontCache: 'global' },
    startup: { typeset: false }
  };
</script><script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js"></script><body>
    <div class="container">
        <div class="header">
            <h1>üá´üá∑ Citation Fran√ßais</h1>
            <p>Flashcards + R√©vision intelligente (localStorage)</p>
        </div>

    <div class="top-panels">
        <div class="panel">
            <div class="panel-row">
				<button class="btn" onclick="window.location.href = "index.html";>üè† Retour</button>
                <button class="btn" onclick="shuffleCards()">üé≤ M√©langer</button>
                <button class="btn secondary" onclick="resetOrder()">‚Ü©Ô∏è Ordre normal</button>
                <button class="btn danger" onclick="resetProgress()">üßπ Reset progr√®s</button>

                <select class="select" id="filterSelect" onchange="applyFilter()">
                    <option value="all">üìö Toutes</option>
                    <option value="review">üü† √Ä revoir</option>
                    <option value="known">üü¢ Ma√Ætris√©es</option>
                </select>
            </div>
        </div>

        <div class="panel">
            <div class="stats" id="statsArea">
                <span class="chip">Chargement...</span>
            </div>
        </div>
    </div>

    <div class="card-scene" onclick="flipCard()">
        <div class="card" id="cardElement">

            <div class="card-face front">
                <div class="card-label bg-question">Question</div>
                <div class="status-pill status-unset" id="statusPill">Non not√©e</div>
                <div class="card-content" id="questionContent"></div>
                <div class="card-hint">Toucher ou Espace pour retourner</div>
            </div>

            <div class="card-face back">
                <div class="card-label bg-answer">R√©ponse</div>
                <div class="card-content" id="answerContent"></div>
            </div>

        </div>
    </div>

    <div class="knowbar">
        <button class="btn btn-dontknow" onclick="markDontKnow(event)">üü† Je sais pas</button>
        <button class="btn btn-know" onclick="markKnow(event)">üü¢ Je sais</button>
    </div>

    <div class="navigation">
        <button class="nav-btn" onclick="previousCard(event)">‚Üê</button>
        <div class="counter">
            <span id="currentCard">1</span> / <span id="totalCards">1</span>
        </div>
        <button class="nav-btn" onclick="nextCard(event)">‚Üí</button>
    </div>

    <div class="progress-bar">
        <div class="progress-fill" id="progressFill"></div>
    </div>

    <div class="keyboard-hint">
        ‚å®Ô∏è Fl√®ches : naviguer ‚Ä¢ Espace : retourner ‚Ä¢ 1 = Je sais pas ‚Ä¢ 2 = Je sais
    </div>
</div>


<script>


const flashcardsData =  [
    {
			id:"citation1",
        q: "II.1 Exp√©rience sensible et esth√©tique ‚Äì Jules Verne",
        a: "¬´ Quel spectacle ! Quelle plume le pourrait d√©crire ! ¬ª (Vingt mille lieues sous les mers, I, XIV, p. ~141 √©d. GF-Flammarion/Folio)\n\nContexte : Admiration devant le spectacle grandiose et lumineux des fonds marins."
    },
    {
			id:"citation2",
        q: "II.1 Exp√©rience sensible et esth√©tique ‚Äì Marlen Haushofer",
        a: "¬´ Rien ne pousse ni ne presse. Je suis la seule √† √™tre impatiente dans cette for√™t et √† en souffrir. ¬ª (Le Mur invisible, Babel/Actes Sud, p. ~143)\n\nContexte : Beaut√© simple, d√©pouill√©e, sans artifice de la nature."
    },
    {
			id:"citation3",
        q: "II.1 Exp√©rience sensible et esth√©tique ‚Äì Marlen Haushofer (dialogue)",
        a: "¬´ La for√™t n'est jamais enti√®rement silencieuse. ¬ª (Le Mur invisible, p. ~140-160)\n\nContexte : Le paysage parle √† travers sons et signes dans la solitude."
    },
    {
			id:"citation4",
        q: "II.1 Exp√©rience sensible et esth√©tique ‚Äì Georges Canguilhem",
        a: "¬´ Le normal n'est pas un fait objectif, c'est une valeur. ¬ª (Le Normal et le Pathologique, PUF, p. ~156)\n\nContexte : Toute perception de la nature est normative, pas de regard innocent."
    },
    {
			id:"citation5",
        q: "II.2 Exp√©rience scientifique ‚Äì Jules Verne",
        a: "¬´ Je notais soigneusement‚Ä¶ ¬ª / ¬´ J'inscrivis avec soin‚Ä¶ ¬ª (Vingt mille lieues sous les mers, chap. XIV-XVII, p. ~120-160)\n\nContexte : Observation pr√©cise, mesure et catalogage scientifique."
    },
    {
			id:"citation6",
        q: "II.2 Exp√©rience scientifique ‚Äì Georges Canguilhem",
        a: "¬´ Le normal n'est pas un fait objectif, c'est une valeur. ¬ª (Le Normal et le Pathologique, p. ~77-156)\n\nContexte : La science biologique juge et √©value selon des normes, non neutre."
    },
    {
	     id:"citation7",
        q: "II.3 Exp√©rience vitale et corporelle ‚Äì Marlen Haushofer",
        a: "¬´ Je suis seule et je dois essayer de survivre aux longs et sombres mois d'hiver. ¬ª (Le Mur invisible, p. 9)\n\n¬´ Ce n'est que lorsque la connaissance d'une chose se r√©pand lentement √† travers le corps qu'on la sait vraiment. ¬ª (p. ~140-160)\n\nContexte : Lutte quotidienne + corps qui d√©cide et apprend la survie."
    },
    {
			id:"citation8",
        q: "II.3 Exp√©rience vitale et corporelle ‚Äì Georges Canguilhem",
        a: "¬´ Vivre, c'est poser des normes ¬ª / instituer des normes dans un milieu (Le Normal et le Pathologique, p. ~156-206)\n\nContexte : Normativit√© vitale ; la vie est pr√©caire et adapte ses r√®gles."
    },
    {
			id:"citation9",
        q: "III.4 Nature indiff√©rente et amorale ‚Äì Marlen Haushofer",
        a: "¬´ C'est comme si la for√™t avait commenc√© √† allonger en moi ses racines [‚Ä¶] la for√™t ne veut pas que les hommes reviennent. ¬ª (Le Mur invisible, p. ~305)\n\n¬´ Aimer et prendre soin d'un √™tre est une t√¢che tr√®s p√©nible et beaucoup plus difficile que tuer ou d√©truire. ¬ª (p. ~200-250)\n\nContexte : Nature implacable, sans exception ni morale."
    },
    {
			id:"citation10",
        q: "III.4 Nature indiff√©rente et amorale ‚Äì Georges Canguilhem",
        a: "La vie suit ses normes biologiques, non des valeurs morales humaines (id√©e centrale du Normal et du Pathologique)\n\nContexte : La vie n'est pas morale."
    },
    {
			id:"citation11",
        q: "III.5 Nature dangereuse et hostile ‚Äì Jules Verne",
        a: "L'oc√©an comme ¬´ force terrible ¬ª (Vingt mille lieues sous les mers, Partie II chap. XIII-XIV)\n\nContexte : Puissance impitoyable, temp√™tes, dangers permanents."
    },
    {
			id:"citation12",
        q: "III.5 Nature dangereuse et hostile ‚Äì Marlen Haushofer",
        a: "Peur permanente des vip√®res, pi√®ges, faim, froid (Le Mur invisible, p. ~81-97 et r√©current)\n\nContexte : Crainte constante face √† la menace naturelle."
    },
    {
			id:"citation13",
        q: "III.6 Nature impr√©visible et chaotique ‚Äì Marlen Haushofer",
        a: "¬´ Il √©tait incontestable que pendant la nuit un mur invisible √©tait descendu‚Ä¶ ¬ª (Le Mur invisible, p. 26)\n\nContexte : Chaos initial inexplicable."
    },
    {
			id:"citation14",
        q: "III.6 Nature impr√©visible et chaotique ‚Äì Jules Verne",
        a: "¬´ L'inconnu nous entourait ¬ª (Vingt mille lieues sous les mers, r√©current dans les profondeurs et p√¥les)\n\nContexte : Myst√®re persistant malgr√© la science."
    },
    {
			id:"citation15",
        q: "IV.7 Technique comme prolongation vitale ‚Äì Jules Verne",
        a: "Le Nautilus permet de vivre dans l'hostile (Vingt mille lieues sous les mers, Partie I chap. XII-XIV)\n\nContexte : Technique comme m√©diation de survie."
    },
    {
			id:"citation16",
        q: "IV.7 Technique comme prolongation vitale ‚Äì Georges Canguilhem",
        a: "La technique prolonge l'adaptation vitale (id√©e de La Connaissance de la vie)\n\nContexte : Technique = cr√©ation de la vie."
    },
    {
			id:"citation17",
        q: "IV.8 Illusion de domination ‚Äì Jules Verne",
        a: "Nemo se consid√®re comme ma√Ætre absolu (Vingt mille lieues sous les mers, attitude r√©currente)\n\nContexte : Illusion humaine de contr√¥ler la nature."
    },
    {
			id:"citation18",
        q: "IV.8 Illusion de domination ‚Äì Marlen Haushofer",
        a: "La for√™t reconquiert, l'homme ne domine rien (Le Mur invisible, p. ~305 et fin)\n\nContexte : Impuissance face √† la nature plus forte."
    },
    {
			id:"citation19",
        q: "V.9 Solitude ‚Äì Marlen Haushofer",
        a: "¬´ Je suis seule‚Ä¶ ¬ª (Le Mur invisible, p. 9 et r√©p√©t√©)\n\nContexte : Solitude fondamentale r√©v√©l√©e par la nature."
    },
    {
			id:"citation20",
        q: "V.9 Solitude ‚Äì Jules Verne",
        a: "Nemo fuit les hommes (Vingt mille lieues sous les mers, motif central)\n\nContexte : Nature comme refuge contre la soci√©t√©."
    },
    {
			id:"citation21",
        q: "V.10 Libert√© ambivalente ‚Äì Marlen Haushofer",
        a: "Libre des contraintes sociales mais prisonni√®re des lois naturelles (sens global du roman)\n\nContexte : Libert√© et prison simultan√©es."
    },
    {
			id:"citation22",
        q: "V.10 Libert√© ambivalente ‚Äì Georges Canguilhem",
        a: "√ätre libre = poser ses propres normes (Le Normal et le Pathologique)\n\nContexte : Libert√© comme normativit√© vitale active."
    },
    {
 			id:"citation23",
        q: "V.11 Violence et n√©cessit√© ‚Äì Marlen Haushofer",
        a: "¬´ Aimer et prendre soin d'un √™tre est une t√¢che tr√®s p√©nible et beaucoup plus difficile que tuer ou d√©truire. ¬ª (Le Mur invisible, p. ~200-250)\n\nContexte : Tuer pour vivre devient n√©cessaire."
    },
    {
			id:"citation24",
        q: "V.11 Violence et n√©cessit√© ‚Äì Jules Verne",
        a: "N√©cessit√© de la chasse/p√™che pour la survie (Vingt mille lieues sous les mers, plusieurs passages)\n\nContexte : Violence justifi√©e par la survie."
    },
    {
			id:"citation25",
        q: "VI.12 Humilit√© et √©galit√© des vivants ‚Äì Jules Verne",
        a: "L'homme insignifiant face √† l'immensit√© oc√©anique (Vingt mille lieues sous les mers, Partie I chap. XIV)\n\nContexte : Grandeur de la nature r√©duit l'homme √† sa petitesse."
    },
    {
			id:"citation26",
        q: "VI.12 Humilit√© et √©galit√© des vivants ‚Äì Marlen Haushofer",
        a: "¬´ Je n'√©tais qu'un √™tre vivant parmi d'autres. ¬ª (Le Mur invisible, sens tr√®s pr√©sent fin du roman, p. ~300-350)\n\nContexte : √âgalit√© biologique avec les animaux."
    },
    {
			id:"citation27",
        q: "VI.13 Patience et temps ‚Äì Marlen Haushofer",
        a: "¬´ J'ai appris √† attendre ¬ª / le temps s'√©tire dans la for√™t (Le Mur invisible, p. ~143)\n\nContexte : Rythme lent impos√© par la nature."
    },
    {
			id:"citation28",
        q: "VI.14 V√©rit√© et lucidit√© ‚Äì Georges Canguilhem",
        a: "La v√©rit√© est normative (Le Normal et le Pathologique, p. ~156)\n\nContexte : V√©rit√© d√©pend des crit√®res humains."
    },
    {
		  id:"citation29",
        q: "VI.14 V√©rit√© et lucidit√© ‚Äì Marlen Haushofer",
        a: "¬´ Tout ce que j'avais pens√© ou fait dans le pass√© n'avait √©t√© qu'une imitation sans valeur. ¬ª (Le Mur invisible, sens de la lucidit√© finale)\n\nContexte : Clart√© sur soi et le monde acquise dans la nature."
    }
];


/* =========================
   localStorage keys
   ========================= */
const LS_KEY_PROGRESS = "citation_flashcards_progress_v1";
const LS_KEY_ORDER = "citat_flashcards_order_v1";
const LS_KEY_FILTER = "fourier_flashcards_filter_v1";

/* =========================
   State
   ========================= */
let baseCards = [...flashcardsData];
let cards = [];
let currentIndex = 0;
let isFlipped = false;

const cardElement = document.getElementById("cardElement");
const statusPill = document.getElementById("statusPill");
const filterSelect = document.getElementById("filterSelect");

/* =========================
   Progress storage
   progressMap[id] = "known" | "review" | null
   ========================= */
function loadProgress() {
    try {
        return JSON.parse(localStorage.getItem(LS_KEY_PROGRESS)) || {};
    } catch {
        return {};
    }
}

function saveProgress(progressMap) {
    localStorage.setItem(LS_KEY_PROGRESS, JSON.stringify(progressMap));
}

/* =========================
   Order storage (array of ids)
   ========================= */
function loadOrder() {
    try {
        return JSON.parse(localStorage.getItem(LS_KEY_ORDER)) || null;
    } catch {
        return null;
    }
}

function saveOrder(orderIds) {
    localStorage.setItem(LS_KEY_ORDER, JSON.stringify(orderIds));
}

/* =========================
   Filter storage
   ========================= */
function loadFilter() {
    return localStorage.getItem(LS_KEY_FILTER) || "all";
}

function saveFilter(value) {
    localStorage.setItem(LS_KEY_FILTER, value);
}

/* =========================
   Helpers
   ========================= */
function setStatusPill(state) {
    statusPill.classList.remove("status-known", "status-unknown", "status-unset");

    if (state === "known") {
        statusPill.classList.add("status-known");
        statusPill.textContent = "Ma√Ætris√©e";
    } else if (state === "review") {
        statusPill.classList.add("status-unknown");
        statusPill.textContent = "√Ä revoir";
    } else {
        statusPill.classList.add("status-unset");
        statusPill.textContent = "Non not√©e";
    }
}

function getCurrentCard() {
    return cards[currentIndex];
}

/* =========================
   Apply filter + order
   ========================= */
function rebuildCardsList(keepIndex = false) {
    const progressMap = loadProgress();
    const filter = filterSelect.value;

    // base list (ordered)
    const orderIds = loadOrder();
    let ordered = [...baseCards];

    if (Array.isArray(orderIds) && orderIds.length === baseCards.length) {
        const map = new Map(baseCards.map(c => [c.id, c]));
        ordered = orderIds.map(id => map.get(id)).filter(Boolean);
    }

    // filter
    if (filter === "known") {
        ordered = ordered.filter(c => progressMap[c.id] === "known");
    } else if (filter === "review") {
        ordered = ordered.filter(c => progressMap[c.id] !== "known");
    }

    // fallback if empty
    if (ordered.length === 0) {
        ordered = [...baseCards];
    }

    const oldId = keepIndex && cards[currentIndex] ? cards[currentIndex].id : null;

    cards = ordered;

    if (keepIndex && oldId) {
        const newIndex = cards.findIndex(c => c.id === oldId);
        currentIndex = newIndex >= 0 ? newIndex : 0;
    } else {
        currentIndex = 0;
    }

    updateCardContent();
}

/* =========================
   UI update
   ========================= */
function updateStats() {
    const progressMap = loadProgress();
    const total = baseCards.length;
    const known = baseCards.filter(c => progressMap[c.id] === "known").length;
    const review = total - known;
    const pct = total === 0 ? 0 : Math.round((known / total) * 100);

    const statsArea = document.getElementById("statsArea");
    statsArea.innerHTML = `
        <span class="chip">üü¢ Ma√Ætris√©es : <strong>${known}</strong> / ${total}</span>
        <span class="chip">üü† √Ä revoir : <strong>${review}</strong> / ${total}</span>
        <span class="chip">üìä ${pct}% ma√Ætris√©</span>
    `;
}

function updateCardContent() {
    if (!cards || cards.length === 0) return;

    const progressMap = loadProgress();
    const card = getCurrentCard();

    const qDiv = document.getElementById("questionContent");
    const aDiv = document.getElementById("answerContent");

    qDiv.innerHTML = card.q;
    aDiv.innerHTML = card.a;

    const status = progressMap[card.id] || null;
    setStatusPill(status);

    document.getElementById("currentCard").textContent = currentIndex + 1;
    document.getElementById("totalCards").textContent = cards.length;

    document.getElementById("progressFill").style.width =
        ((currentIndex + 1) / cards.length) * 100 + "%";

    updateStats();

    if (window.MathJax) {
        MathJax.typesetPromise([qDiv, aDiv]);
    }
}

/* =========================
   Actions
   ========================= */
function flipCard() {
    isFlipped = !isFlipped;
    cardElement.classList.toggle("is-flipped", isFlipped);
}

function nextCard(e) {
    if (e) e.stopPropagation();
    isFlipped = false;
    cardElement.classList.remove("is-flipped");

    setTimeout(() => {
        currentIndex = (currentIndex + 1) % cards.length;
        updateCardContent();
    }, 200);
}

function previousCard(e) {
    if (e) e.stopPropagation();
    isFlipped = false;
    cardElement.classList.remove("is-flipped");

    setTimeout(() => {
        currentIndex = (currentIndex - 1 + cards.length) % cards.length;
        updateCardContent();
    }, 200);
}

function shuffleCards() {
    isFlipped = false;
    cardElement.classList.remove("is-flipped");

    setTimeout(() => {
        // shuffle order IDs and store it
        const ids = [...baseCards.map(c => c.id)];
        ids.sort(() => Math.random() - 0.5);
        saveOrder(ids);

        rebuildCardsList(false);
    }, 250);
}

function resetOrder() {
    localStorage.removeItem(LS_KEY_ORDER);
    rebuildCardsList(false);
}

function resetProgress() {
    if (!confirm("Reset complet : tu veux supprimer toutes tes cartes ma√Ætris√©es/√† revoir ?")) return;
    localStorage.removeItem(LS_KEY_PROGRESS);
    rebuildCardsList(true);
}

function markKnow(e) {
    if (e) e.stopPropagation();

    const progressMap = loadProgress();
    const card = getCurrentCard();
    progressMap[card.id] = "known";
    saveProgress(progressMap);

    updateCardContent();
    // auto-next pour r√©vision rapide
    setTimeout(() => nextCard(), 150);
}

function markDontKnow(e) {
    if (e) e.stopPropagation();

    const progressMap = loadProgress();
    const card = getCurrentCard();
    progressMap[card.id] = "review";
    saveProgress(progressMap);

    updateCardContent();
    setTimeout(() => nextCard(), 150);
}

function applyFilter() {
    const val = filterSelect.value;
    saveFilter(val);
    rebuildCardsList(false);
}

/* =========================
   Keyboard shortcuts
   ========================= */
document.addEventListener('keydown', (e) => {
    if (e.key === 'ArrowRight') nextCard();
    if (e.key === 'ArrowLeft') previousCard();

    if (e.key === ' ' || e.key === 'Enter') {
        e.preventDefault();
        flipCard();
    }

    // 1 = je sais pas / 2 = je sais
    if (e.key === '1') markDontKnow();
    if (e.key === '2') markKnow();
});

/* =========================
   Mobile swipe
   ========================= */
let touchStartX = 0;
const scene = document.querySelector('.card-scene');

scene.addEventListener('touchstart', e => {
    touchStartX = e.changedTouches[0].screenX;
});

scene.addEventListener('touchend', e => {
    let touchEndX = e.changedTouches[0].screenX;
    handleSwipe(touchStartX, touchEndX);
});

function handleSwipe(start, end) {
    const threshold = 50;
    if (start - end > threshold) nextCard();
    if (end - start > threshold) previousCard();
}

/* =========================
   Init
   ========================= */
(function init() {
    // restore filter
    const savedFilter = loadFilter();
    filterSelect.value = savedFilter;

    rebuildCardsList(false);
})();
</script></body>
</html> 
